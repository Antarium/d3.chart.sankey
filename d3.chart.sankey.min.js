!function(a,b){"use strict";"function"==typeof a.define&&a.define.amd?define(["d3"],function(c){b(a,c)}):b(a,a.d3)}(this,function(a,b){"use strict";b.chart("Sankey.Base",{initialize:function(){var a=this;a.features={},a.d3={},a.layers={},a.base.attr("width",a.base.node().parentNode.clientWidth),a.base.attr("height",a.base.node().parentNode.clientHeight),a.features.margins={top:1,right:1,bottom:6,left:1},a.features.width=a.base.attr("width")-a.features.margins.left-a.features.margins.right,a.features.height=a.base.attr("height")-a.features.margins.top-a.features.margins.bottom,a.features.name=function(a){return a.name},a.features.colorNodes=b.scale.category20c(),a.features.colorLinks=null,a.layers.base=a.base.append("g").attr("transform","translate("+a.features.margins.left+","+a.features.margins.top+")")},name:function(a){return arguments.length?(this.features.name=a,this.trigger("change:name"),this.root&&this.draw(this.root),this):this.features.name},colorNodes:function(a){return arguments.length?(this.features.colorNodes=a,this.trigger("change:color"),this.root&&this.draw(this.root),this):this.features.colorNodes},colorLinks:function(a){return arguments.length?(this.features.colorLinks=a,this.trigger("change:color"),this.data&&this.draw(this.data),this):this.features.colorLinks}}),b.chart("Sankey.Base").extend("Sankey",{initialize:function(){function a(a){return"function"==typeof d.features.colorNodes?d.features.colorNodes(d.features.name(a),a):d.features.colorNodes}function c(a){return"function"==typeof d.features.colorLinks?d.features.colorLinks(a):d.features.colorLinks}var d=this;d.d3.sankey=b.sankey(),d.d3.path=d.d3.sankey.link(),d.d3.sankey.size([d.features.width,d.features.height]),d.features.iterations=32,d.features.nodeWidth=d.d3.sankey.nodeWidth(),d.features.nodePadding=d.d3.sankey.nodePadding(),d.layers.links=d.layers.base.append("g").classed("links",!0),d.layers.nodes=d.layers.base.append("g").classed("nodes",!0),d.on("change:sizes",function(){d.d3.sankey.nodeWidth(d.features.nodeWidth),d.d3.sankey.nodePadding(d.features.nodePadding)}),d.layer("links",d.layers.links,{dataBind:function(a){return this.selectAll(".link").data(a.links)},insert:function(){return this.append("path").classed("link",!0)},events:{enter:function(){this.attr("d",d.d3.path).style("stroke",c).style("stroke-width",function(a){return Math.max(1,a.dy)}).sort(function(a,b){return b.dy-a.dy}),this.on("mouseover",function(a){d.trigger("link:mouseover",a)}),this.on("mouseout",function(a){d.trigger("link:mouseout",a)}),this.on("click",function(a){d.trigger("link:click",a)})}}}),d.layer("nodes",d.layers.nodes,{dataBind:function(a){return this.selectAll(".node").data(a.nodes)},insert:function(){return this.append("g").classed("node",!0)},events:{enter:function(){this.attr("transform",function(a){return"translate("+a.x+","+a.y+")"}),this.append("rect").attr("height",function(a){return a.dy}).attr("width",d.features.nodeWidth).style("fill",a).style("stroke",function(c){return b.rgb(a(c)).darker(2)}),this.append("text").attr("x",-6).attr("y",function(a){return a.dy/2}).attr("dy",".35em").attr("text-anchor","end").attr("transform",null).text(d.features.name).filter(function(a){return a.x<d.features.width/2}).attr("x",6+d.features.nodeWidth).attr("text-anchor","start"),this.on("mouseover",function(a){d.trigger("node:mouseover",a)}),this.on("mouseout",function(a){d.trigger("node:mouseout",a)}),this.on("click",function(a){d.trigger("node:click",a)})}}})},transform:function(a){var b=this;return b.d3.sankey.nodes(a.nodes).links(a.links).layout(b.features.iterations),a},iterations:function(a){return arguments.length?(this.features.iterations=a,this.data&&this.draw(this.data),this):this.features.iterations},nodeWidth:function(a){return arguments.length?(this.features.nodeWidth=a,this.trigger("change:sizes"),this.data&&this.draw(this.data),this):this.features.nodeWidth},nodePadding:function(a){return arguments.length?(this.features.nodePadding=a,this.trigger("change:sizes"),this.data&&this.draw(this.data),this):this.features.nodePadding}})});